<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<title>Talkk</title>
<link rel="stylesheet" href="/static/home/home.css">
</head>

<body class="dark">

<script>
/* stars */
for(let i=0;i<60;i++){
 let s=document.createElement("div");
 s.className="star";
 s.style.left=Math.random()*100+"%";
 s.style.top=Math.random()*100+"%";
 document.body.appendChild(s);
}
</script>

<!-- bubbles -->
<div class="bubble" style="width:200px;height:200px;left:10%;top:20%;background:#8f00ff;"></div>
<div class="bubble" style="width:260px;height:260px;left:70%;top:30%;background:#00f2fe;"></div>
<div class="bubble" style="width:150px;height:150px;left:40%;top:70%;background:#ff0080;"></div>

<div class="top-bar">
  <div class="user">{{ user }}</div>
  <input class="search" placeholder="Search users">
  <div class="bell-wrap" onclick="toggleNotify(event)">
    <div class="bell" id="bell">ğŸ””</div>
    <div class="badge" id="badge"></div>
  </div>
</div>

<div class="notify-panel" id="notify">
  <h3>Notifications</h3>
  <div id="notifyList"></div>
  <div id="emptyMsg" style="text-align:center;opacity:.6;margin-top:30px;">
    No new notifications
  </div>
</div>

<div class="settings-panel" id="settings" onclick="event.stopPropagation()">
  <div class="setting-btn" onclick="toggleDark(event)">ğŸŒ— Toggle Theme</div>
  <div class="setting-btn" onclick="window.location.href='/logout'">ğŸšª Logout</div>
</div>

<div class="bottom-nav">
  <div class="nav-btn" onclick="window.location.href='/video'">ğŸ“¹<span>Video</span></div>
  <div class="nav-btn">ğŸ’¬<span>Chat</span></div>
  <div class="nav-btn">ğŸ‘¤<span>Profile</span></div>
  <div class="nav-btn" onclick="toggleSettings(event)">âš™ï¸<span>Settings</span></div>
</div>

<script>
const notify = document.getElementById("notify");
const notifyList = document.getElementById("notifyList");
const badge = document.getElementById("badge");
const bell = document.getElementById("bell");
const settings = document.getElementById("settings");
const emptyMsg = document.getElementById("emptyMsg");

let notifications = JSON.parse(localStorage.getItem("talkk_notifications") || "[]");
let deleteTimer = null;

/* save */
function save(){
  localStorage.setItem("talkk_notifications", JSON.stringify(notifications));
}

/* badge */
function updateBadge(){
  const unread = notifications.filter(n=>!n.read).length;
  badge.innerText = unread;
  badge.style.display = unread ? "block" : "none";
}

/* render */
function render(){
  notifyList.innerHTML="";

  if(notifications.length===0){
    emptyMsg.style.display="block";
    return;
  }
  emptyMsg.style.display="none";

  notifications.forEach(n=>{
    const card = document.createElement("div");
    card.className="notify-card "+(n.read?"":"unread");

    const text = document.createElement("div");
    text.innerText=n.text;

    const del = document.createElement("div");
    del.className="delete-btn";
    del.innerText="Delete";

    card.appendChild(text);
    card.appendChild(del);
    notifyList.appendChild(card);

    addSwipe(card,n.id);
  });
}

/* swipe */
function addSwipe(card,id){
  let startX=0;

  card.addEventListener("touchstart",e=>startX=e.touches[0].clientX);
  card.addEventListener("touchmove",e=>{
    if(e.touches[0].clientX-startX>50) card.classList.add("swipe");
  });

  card.querySelector(".delete-btn").onclick=()=>{
    deleteWithUndo(id,card);
  };
}

/* delete + undo */
function deleteWithUndo(id,card){
  const notif = notifications.find(n=>n.id===id);
  if(!notif) return;

  if(!notif.read){
    notif.read=true;
    updateBadge();
  }

  card.innerHTML="<b>Deleted</b> â€” <span style='color:cyan;cursor:pointer'>UNDO</span>";

  deleteTimer=setTimeout(()=>{
    notifications=notifications.filter(n=>n.id!==id);
    save();
    render();
  },2000);

  card.querySelector("span").onclick=()=>{
    clearTimeout(deleteTimer);
    render();
  };
}

/* demo */
if(notifications.length===0){
  for(let i=1;i<=15;i++){
    notifications.push({
      id:Date.now()+i,
      text:["Hi","New Message","Followed you","Commented","Good Morning"][i%5],
      read:false
    });
  }
  save();
}

/* bell */
function toggleNotify(e){
 e.stopPropagation();
 bell.classList.add("shake");
 setTimeout(()=>bell.classList.remove("shake"),400);
 notify.classList.toggle("show");

 if(notify.classList.contains("show")){
   notifications.forEach(n=>n.read=true);
   save();
   updateBadge();
   render();
 }
}

/* settings */
function toggleSettings(e){
 e.stopPropagation();
 settings.classList.toggle("show");
}

/* dark */
function toggleDark(e){
 e.stopPropagation();
 document.body.classList.toggle("dark");
 document.body.classList.toggle("light");
}

/* close */
document.addEventListener("click",()=>{
 notify.classList.remove("show");
 settings.classList.remove("show");
});

render();
updateBadge();
</script>

</body>
</html>










